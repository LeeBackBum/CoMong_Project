<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.sm.app.repository.UserRepository">

    <!-- 특정 userId로 사용자 정보 조회 -->
    <select id="selectOne" parameterType="String" resultType="userDto">
        SELECT userId, userPwd, userEmail, userName, userAddress, userAge, userSex, diseaseStatus, userNumber
        FROM user
        WHERE userId = #{userId}
    </select>

    <!-- 모든 사용자 정보 조회 -->
    <select id="select" resultType="userDto">
        SELECT userId, userPwd, userEmail, userName, userAddress, userAge, userSex, diseaseStatus, userNumber
        FROM user
    </select>

    <!-- 의사 ID에 따른 예약 및 상담 정보를 조회 -->
    <select id="selectAppointments" parameterType="String" resultType="appointmentDto">
        SELECT DISTINCT u.user_name, u.user_age, u.user_sex, u.disease_status, u.user_number, '예약' AS appointment_type, ma.appointment_date AS date
        FROM medical_appointment AS ma
            JOIN user AS u ON ma.user_id = u.user_id
        WHERE ma.doctor_id = #{doctorId}

        UNION

        SELECT DISTINCT u.user_name, u.user_age, u.user_sex, u.disease_status, u.user_number, '상담' AS appointment_type, c.counsel_date AS date
        FROM counsel AS c
            JOIN user AS u ON c.user_id = u.user_id
        WHERE c.doctor_id = #{doctorId}

        ORDER BY date DESC
    </select>
</mapper>
